<!DOCTYPE html>
<html>
<head>
	<meta content='text/html;charset=UTF-8' http-equiv='content-type' />
	<title>Virtual Living Room v0</title>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript">
		var LivingRoomModule = (function () {
			var myModule = {};
			
			myModule.currentPlaylist = "PL217AE1080CD2D2CD";
			myModule.currentVideoIndex = 0;
			myModule.currentTime = 0;
			
			myModule.cuePlaylist = function() {
				$.ajax({
					url: "http://livingroomsyncservice.apphb.com/Sync/GetCursor",
					dataType: "jsonp",
					success: function(data, textStatus, jqXHR) {
						alert("GetCursor call succeeded");
						this.player.cuePlaylist({list: this.currentPlaylist, index: this.currentVideoIndex, startSeconds: this.currentTime, suggestedQuality: "medium"}); 
					}					
				});
				
			};
			
			myModule.startPlayer = function() {
				this.player.playVideo();
			};
			return myModule;
		}());
	
		function onPlayerStateChange(newState) {
			if (newState == 5) {
				LivingRoomModule.startPlayer();				
			}			
		};
		
		function onYouTubePlayerReady(playerId) {
			var player;
			var currentVideoIndex, currentTime;
			player = swfobject.getObjectById(playerId);
			if (player) {
				$(document).ready(function() {
					player.addEventListener("onStateChange", "onPlayerStateChange");
					LivingRoomModule.player = player;
					LivingRoomModule.cuePlaylist();
				});
			}
		};		

	</script>
</head>
<body>
	<h1>Virtual Living Room v0</h1>
	<div id="playerContainer">
		<p>This is where the youtube player would go if you had Flash installed.</p>
	</div>
	<script type="text/javascript">

		var params = { allowScriptAccess: "always" };
		var atts = { id: "ytPlayer" };
		swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&amp;version=3&amp;playerapiid=ytPlayer",
                       "playerContainer", "640", "360", "8", null, null, params, atts);

  </script>
</body>
</html>